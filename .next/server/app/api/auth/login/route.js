"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},86003:e=>{e.exports=require("dns/promises")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},90382:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>E,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>S,staticGenerationAsyncStorage:()=>q});var s={};r.r(s),r.d(s,{POST:()=>f,runtime:()=>g});var n=r(54631),o=r(52385),a=r(83205),i=r(66525),l=r(86003),u=r(10801),p=r.n(u),d=r(16975),c=r(38654),m=r(45598);let g="nodejs",h=/.+@.+\..+/;async function x(e){let t=e.split("@")[1]?.toLowerCase();if(!t)return!1;try{let e=await (0,l.resolveMx)(t);return Array.isArray(e)&&e.length>0}catch(e){return console.error("MX lookup failed",e),!1}}let w=e=>{let t=process.env.JWT_SECRET;if(!t)throw Error("JWT_SECRET not defined in environment variables");let r=process.env.JWT_EXPIRES_IN||"7d";return p().sign({id:e},t,{expiresIn:r})};async function f(e){await (0,d.Z)();try{let{email:t,password:r}=await e.json();if(!t||!r)return i.NextResponse.json({message:"Email and password are required"},{status:400});let s=t.trim().toLowerCase();if(!h.test(s))return i.NextResponse.json({message:"Email is not valid"},{status:400});if(!await x(s))return i.NextResponse.json({message:"Email domain could not be verified. Please use a valid email."},{status:400});let n=await c.Z.findOne({email:s}).select("+password");if(!n||!await n.comparePassword(r))return i.NextResponse.json({message:"Invalid credentials"},{status:401});let o=w(String(n._id));return(0,m.cookies)().set("token",o,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:604800,path:"/"}),i.NextResponse.json({message:"Login successful",token:o,user:{id:n._id,name:n.name,email:n.email}})}catch(e){return console.error("Login Error:",e),i.NextResponse.json({message:"Server error"},{status:500})}}let v=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/aman/Downloads/portray-build-shine-main/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:q,serverHooks:S}=v,j="/api/auth/login/route";function E(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:q})}},16975:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(11185),n=r.n(s);let o=process.env.DB_URI;if(!o)throw Error("Please define the DB_URI environment variable inside .env.local");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let i=async function(){return a.conn||(a.promise||(a.promise=n().connect(o,{bufferCommands:!1}).then(e=>e)),a.conn=await a.promise),a.conn}},38654:(e,t,r)=>{r.d(t,{Z:()=>l});var s=r(11185),n=r.n(s),o=r(8865),a=r.n(o);let i=new(n()).Schema({name:{type:String,required:!0,trim:!0,minlength:2},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:/.+@.+\..+/},password:{type:String,required:!0,minlength:6,select:!1},resetPasswordToken:{type:String,select:!1},resetPasswordExpires:{type:Date,select:!1}},{timestamps:!0});i.pre("save",async function(e){if(!this.isModified("password")||!this.password)return e();let t=await a().genSalt(10);this.password=await a().hash(this.password,t),e()}),i.methods.comparePassword=function(e){return a().compare(e,this.password)};let l=n().models.User||n().model("User",i)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[751,319,865,519],()=>r(90382));module.exports=s})();