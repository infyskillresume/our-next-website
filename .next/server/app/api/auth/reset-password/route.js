"use strict";(()=>{var e={};e.id=436,e.ids=[436],e.modules={11185:e=>{e.exports=require("mongoose")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},56354:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w});var r={};t.r(r),t.d(r,{POST:()=>l});var a=t(54631),o=t(52385),n=t(83205),i=t(66525),p=t(6113),d=t(16975),u=t(38654);async function l(e){await (0,d.Z)();try{let{token:s,password:t,confirmPassword:r}=await e.json();if(!s||"string"!=typeof s)return i.NextResponse.json({message:"Reset token is required"},{status:400});if(!t||"string"!=typeof t)return i.NextResponse.json({message:"Password is required"},{status:400});if(t.length<6)return i.NextResponse.json({message:"Password must be at least 6 characters long"},{status:400});if(t!==r)return i.NextResponse.json({message:"Passwords do not match"},{status:400});let a=(0,p.createHash)("sha256").update(s).digest("hex"),o=await u.Z.findOne({resetPasswordToken:a,resetPasswordExpires:{$gt:new Date}}).select("+password +resetPasswordToken +resetPasswordExpires");if(!o)return i.NextResponse.json({message:"Reset token is invalid or has expired"},{status:400});return o.password=t,o.resetPasswordToken=void 0,o.resetPasswordExpires=void 0,await o.save(),i.NextResponse.json({message:"Password has been reset successfully"})}catch(e){return console.error("Reset password error",e),i.NextResponse.json({message:"Unable to reset password right now."},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"/home/aman/Downloads/portray-build-shine-main/app/api/auth/reset-password/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:h}=c,g="/api/auth/reset-password/route";function x(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},16975:(e,s,t)=>{t.d(s,{Z:()=>i});var r=t(11185),a=t.n(r);let o=process.env.DB_URI;if(!o)throw Error("Please define the DB_URI environment variable inside .env.local");let n=global.mongoose;n||(n=global.mongoose={conn:null,promise:null});let i=async function(){return n.conn||(n.promise||(n.promise=a().connect(o,{bufferCommands:!1}).then(e=>e)),n.conn=await n.promise),n.conn}},38654:(e,s,t)=>{t.d(s,{Z:()=>p});var r=t(11185),a=t.n(r),o=t(8865),n=t.n(o);let i=new(a()).Schema({name:{type:String,required:!0,trim:!0,minlength:2},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:/.+@.+\..+/},password:{type:String,required:!0,minlength:6,select:!1},resetPasswordToken:{type:String,select:!1},resetPasswordExpires:{type:Date,select:!1}},{timestamps:!0});i.pre("save",async function(e){if(!this.isModified("password")||!this.password)return e();let s=await n().genSalt(10);this.password=await n().hash(this.password,s),e()}),i.methods.comparePassword=function(e){return n().compare(e,this.password)};let p=a().models.User||a().model("User",i)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[751,319,865],()=>t(56354));module.exports=r})();